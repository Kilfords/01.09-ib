Домашнее задание к занятию "«Резервное копирование баз данных»" - Боковиков Илья студента
Инструкция по выполнению домашнего задания

    Сделайте fork данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
    Выполните клонирование данного репозитория к себе на ПК с помощью команды git clone.
    Выполните домашнее задание и заполните у себя локально этот файл README.md:
        впишите вверху название занятия и вашу фамилию и имя
        в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
        для корректного добавления скриншотов воспользуйтесь инструкцией "Как вставить скриншот в шаблон с решением
        при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в инструкции по MarkDown)
    После завершения работы над домашним заданием сделайте коммит (git commit -m "comment") и отправьте его на Github (git push origin);
    Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
    Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.

Задание 1. Резервное копирование
Кейс

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
Полное (fullbackup) резервное копирование
Суть:
Каждый день (например, ночью) создаётся полная копия всей базы данных.
В случае сбоя можно восстановить всё состояние на момент вчерашнего бэкапа.
Пример:
В 02:00 каждую ночь делается полный бэкап базы.
Если сегодня в 15:00 всё рухнуло — мы восстанавливаем данные с бэкапа от 02:00 вчера. Соответсвенно через crontab

Плюсы:
Быстрое восстановление данных
Простое управление 
Асе данные содержаться в одной резервной копии

Минусы:
Большой объём данных
Долгое создание копии (если база крупная)
Высокая нагрузка сети

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

Инкрементное (incremental) или дифференциальное (differential) копирование
журнал транзакций (transaction log backup)
Суть:
Полный бэкап делается, допустим, раз в сутки.
А затем каждый час (или чаще) сохраняются изменения (инкрементные копии).
При сбое можно «прокрутить» базу до нужного времени — хоть за час, хоть за 5 минут до падения.

Пример:
Полный бэкап в 00:00.
Инкрементные копии: 01:00, 02:00, 03:00 …
Система упала в 14:30 — восстанавливаем бэкап с 00:00 + все инкременты до 14:00 → получаем состояние почти на момент аварии.

Плюсы:
Можно восстановиться до почти любого момента.
Меньше места, чем у полного бэкапа каждый час.

Минусы:
Восстановление чуть сложнее — нужно собрать цепочку копий.
При потере одного инкремента может нарушиться вся последовательность.

Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

pg_dump - отвечает за резервное копирование в PostgreSQL 
Делает скрин код и с него воздаст БД 
pg_dump / pg_dumpall 
Создаёт SQL - скрипт с командами для восстановления объектов БД и данных 
Подходит для небольших БД (<100 гб), миграций между версиями выборочного восстановления таблиц
Особенности 
- требует свободного места для хранения SQL-файла 
- Медленный для больших БД 
- Блокирует только те таблицы которые дампит (не блокирует всю БД)
- Можно восстанавливать на других версиях Postgres 
А так же не требует остановки сервера, то есть можно делать на горячую 
Пример команды 
pg_dump -U postgres -F /backup/finance_db.backup finance_db

Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

Резервное копирование MySQL 
Физическое (бинарное) резервное копирование 
Это копирование файлов данных напрямую (файлы.ibd, .frm, .MYD, .MYI бинарные логи и т д)
Преимущества 
- быстрое восстановление, минимальная нагрузка на сервер 

Недостатки 
- Непереносимость между версиями MySQL/OC требуется остановка сервера или блокировка (если не использовать специнструменты)
Инструменты 
- Percona XtraBackup (для InnoDB/XtraDB)
- MySQL Enterprise Backup 
- Файловые снимки (LVM, ZFS) - снэпшоты 
Снэпшот - это мгновенная копия блоков диска на конкретный момент времени 
Для MySQL это значит 
- Сервер не останавливается 
- Чтение данных доступно во время создания 
- Запись блокируется на доли секунды 
1. Подготовка 
- Данные MySQL должны хранится в отдельном логическом томе (пример /dev/vh-data/mysql_volume)
2. Блокировка записей во все таблицы MySQL 
FLUSH TABLES WITH READ LOCK
3. Сбрасываем кэш логов на диск 
FLUSH ENGINE LOGS
 Важно что пока действет блокировка SELECT работают, INSERT/UPDATE/DELETE ЖДУТ!.
4. Создание снэпшота 
- lvreate - -size 5G - -snapshot - -name mysql_snap /dev/vh-data/mysql_volume
Как это работает 
- LVM создает виртуальную копию тома 
- Дальнейшие изменения запишутся в отдельное место 
- Исходные данные 'замораживаются' в снэпшоте 
5. Снятие блокировки MySQL 
- UNLOCK TABLES 
После снятия блокировки сервер возобновляет работу в штатном режиме 

mysqldump — это программа, которая создаёт логическую копию базы данных:
она выгружает структуру (DDL) и данные (DML) в виде SQL-скрипта, который потом можно выполнить и восстановить БД в исходное состояние.